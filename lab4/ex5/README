A local lan with 1 server and 1 pc, a default gateway. The assignment is
to properly configure the router to act NAT and regulation, making
possible to access the internal server from the "outside" (namely
the IP address of the firewall).

- r1 has to act as the router and masquerade the packet that exit
  from its eth1 interface (notice that eth1 IP is dynamically assigned)

- s1 has to be reachable from "outside" using DNAT on r1 (namely, r1
  has to forward to s1 the packets arriving on the http/https ports, namely
  80, 443)

- pc1 has to be reachable from "outside" using DNAT on r1 (namely, r1
  has to forward to pc1 the packets arriving on the ssh port (namely 22)

- r1 has to drop ICMP echo request to itself

- r1 has to respond with TCP RST or ICMP Unreachable for incoming
  requests for blocked ports

FOR SOLUTION

# masquerading outgoing traffic eth1
iptables -t nat -A POSTROUTING -o eth1 -j MASQUERADE

# SNAT
# Change source ip to the router's one on incoming pkts
iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE

# DNAT
# incoming packets are redirected to dedicated servers
# http/https
iptables -A PREROUTING -t nat -i eth1 -p tcp --dport 80 -j DNAT --to-destination 192.168.10.18:80
iptables -A PREROUTING -t nat -i eth1 -p tcp --dport 443 -j DNAT --to-destination 192.168.10.18:443
# ssh
iptables -A PREROUTING -t nat -i eth1 -p tcp --dport 22 -j DNAT --to-destination 192.168.10.22:22

# keep outgoing traffic on the same port
iptables -I POSTROUTING -t nat -o eth1 -m multiport -p tcp --dports 22:443 -j MASQUERADE --to-ports 22-443

# drop icmp and all other traffic
iptables -A INPUT -i eth1 -j REJECT
iptables -A FORWARD -i eth1  -m multiport -p tcp ! --dports 22,80,443 -j REJECT
